# MVP веб-приложения для отслеживания изменений в Google Sheet

![Frontend](frontend.png)

Ссылка на страницу Google Sheet, откуда должен производиться парсинг данных - [googlesheet](https://bit.ly/3SAz6gY). На странице представлен импровизированный список заказов с их номерами, стоимостью в долларах и сроками поставки.

Приложние состоит из 3 частей: backend на Django, frontend на React.js и телеграм-бот. Запаковано в docker.

Backend отвечает за:
- парсинг google sheet странички с определенным интервалом
- запись данных парсинга в базу данных с расчетом стоимости в рублях
- раздача этих данных через api endpoint

Frontend овтечает за отображение в виде SPA:
- данных, запрашиваемых через API бэкенда
- линейного графика стоимости заказов
- общей суммы всех заказов в рублях

Бот отвечает за:
- отображение по команде общего числа и номеров просроченных заказов
- доставку уведомлений об общем числе просроченных заказов с определенным интервалом

## Запуск dev-версии приложения

1. Клонируйте репозиторий и перейдите в него

```sh
https://github.com/balancy/canalservice_orders.git
```

```sh
cd canalservice_orders
```

2. Задайте переменные окружения

Создайте файл `.env` в папке bot:

```sh
touch bot/.env
```

Пропишите в него телеграм токен, который можно получить у [@BotFather](@BotFather) в формате:

```sh
TELEGRAM_TOKEN=ваш_токен
```

3. Запуск приложения
```
docker-compose up -d --build
```

API будет доступно по адресу

[http://localhost:8080/orders/](http://localhost:8080/orders/)

SPA будет доступно по адресу

[http://localhost:3000/](http://localhost:3000/)


### Другие переменные окружения
Задавать эти переменные для локальной развертки не нужно.

#### backend/.env

- `SECRET_KEY` - секретный ключ для django. По умолчанию генерируется случайным образом.
- `DEBUG` - режим отладки. По умолчанию включен.
- `ALLOWED_HOSTS` - список разрешенных хостов. По умолчанию localhost.
- `ORDERS_GOOGLESHEET_ID` - id странички Google Sheet. По умолчанию предоставлено.
- `DB_REFRESH_INTERVAL` - интервал парсинга новых данных из Google Sheet. По умолчанию 10 секунд.

#### frontend/.env

- `REACT_APP_BACKEND_HOST` - имя хоста, откуда React запрашивает данные. По умолчанию localhost.
- `REACT_APP_REFRESH_INTERVAL_DURATION` - интервал обновления данных на странице.

#### bot/.env

- `NOTIFICATION_TIMEOUT` - интервал отправки уведомлений о просроченных ордерах. По умолчанию 60 минут.
